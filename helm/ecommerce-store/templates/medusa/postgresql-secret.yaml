{{- if eq .Values.engine "medusa" }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "ecommerce-store.medusa.postgresqlSecretName" . }}
  labels:
    {{- include "ecommerce-store.medusa.labels" . | nindent 4 }}
    app.kubernetes.io/component: database
type: Opaque
stringData:
  username: {{ .Values.medusa.postgresql.username | default "medusa" | quote }}
  password: {{ .Values.medusa.postgresql.password | default "changeme-medusa" | quote }}
  database: {{ .Values.medusa.postgresql.database | default "medusa" | quote }}
  # Full connection URL for Medusa backend
  database-url: "postgres://{{ .Values.medusa.postgresql.username | default "medusa" }}:{{ .Values.medusa.postgresql.password | default "changeme-medusa" }}@{{ include "ecommerce-store.fullname" . }}-medusa-db:5432/{{ .Values.medusa.postgresql.database | default "medusa" }}"
{{- end }}
